# Singleton Pattern

***

### 📌 싱글톤 패턴이란?

- 1개의 객체만을 인스턴스로 생성한 후 어디서든 해당 객체에 접근할 때 인스턴스로 접근하도록 하기 위한 패턴

***

### 📌 Initialization on demand holder idiom (holder에 의한 초기화)

- `static` 키워드를 이용하여 클래스 로딩시점에서 1개의 객체를 생성 
- 앞으로 해당 객체에 접근하기 위해서는 `getInstance()`를 통해서만 접근이 가능하다.
- 객체의 생성자의 접근 제어자를 `private`으로 설정하여 새로운 객체의 생성을 막는다. 

```java
public class UserRepository {

    // 클래스가 메모리에 올라갈 때 static 수식자가 붙은 변수도 같이 메모리에 올라감.
    // 클래스가 메모리에 올라갈 때 새로운 객체(new UserRepository) 생성
    private static final UserRepository userRepository = new UserRepository();

    // 클래스가 메모리에 올라갈 때 생성한 1개의 UserRepository 반환함.
    public static UserRepository getInstance() {
        return userRepository;
    }

    // new 키워드를 이용한 객체 생성 제한
    private UserRepository() {
    }
}
```

***

### 📌 싱글톤 패턴의 단점

- 싱글톤 패턴을 구현하는 코드 자체가 많이 필요하다.
- 동시성 문제가 발생할 수 있다.
- 싱글톤 인스턴스는 자원을 공유하고 있기 때문에 테스트가 격리된 환경에서 수행되려면 매번 인스턴스의 상태를 초기화시켜주어야 하기 때문에 테스트하기 어렵다.
- 의존 관계상 클라이언트가 구체 클래스에 의존하게 된다.

***

### 📌 스프링 컨테이너

- 스프링 컨테이너는 싱글톤 패턴을 적용하지 않아도 싱글톤으로 객체들을 관리한다. 
- 스프링 컨테이너는 싱글톤 컨테이너 역할을 한다. 이처럼 싱글톤 객체를 생성및 관리하는 기능을 싱글톤 레지스트리라 한다.
- 이렇게 스프링 컨테이너에서 싱글톤 컨테이너 역할을 해줌으로써 싱글톤 패턴의 단점을 없애고 객체의 단일성을 유지할 수 있다.
  - 그렇기에 각각의 빈들은 싱글톤 패턴 적용을 위한 코드를 작성할 필요가 없다.
  - DIP, OCP, 테스트, private 생성자를 고민하지 않아도 된다. 

### 📌 싱글톤 방식의 주의점
- 객체가 상태를 유지하는 `stateful` 방식의 객체이면 문제가 발생할 수 있으므로 상태를 유지하지 않는 `stateless` 상태로 객체를 설계해야 한다.
  - 싱글톤 패턴에서는 객체 인스턴스를 하나만 생성해서 공유하는 방식이기 때문에 여러 클라이언트에서 해당 인스턴스를 공유하게된다.
  - 만약 `stateful` 방식의 객체일 경우 동시성 문제가 발생할 수 있다.